{% set intvars = interfaces[ansible_hostname] %}
{% set neighborvars = intvars['neighbors'] %}
# /etc/network/interfaces template for servers ({{ansible_hostname}})
# Created by Ansible

auto lo
iface lo inet loopback

auto lo
iface lo inet static
    address {{ intvars.loopback }}
    netmask 255.255.255.255

auto eth0
iface eth0 inet dhcp

{% for iface in neighborvars %}
auto {{ iface }}
iface {{ iface }} manual
    mtu 1500
iface {{ iface }} inet static
    address {{ intvars.loopback }}
    netmask 255.255.255.255
iface {{ iface }} inet6 static
    address {{ intvars.loopbackv6 }}
    netmask 128
{% endfor %}
